local Players = game:GetService("Players")
local ContentProvider = game:GetService("ContentProvider") -- ì—ì…‹ ë¡œë”© ì„œë¹„ìŠ¤
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TweenService = game:GetService("TweenService")

local SceneManager = {}

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- UIë“¤ ë¯¸ë¦¬ ì°¾ì•„ë†“ê¸° (ì´ë¦„ì´ ì •í™•í•´ì•¼ í•©ë‹ˆë‹¤!)
local mainScene = playerGui:WaitForChild("MainScene")
local loadingScene = playerGui:WaitForChild("LoadingScene")
local ingameScene = playerGui:WaitForChild("IngameScene")
local queuePopup = playerGui:WaitForChild("QueuePopup")

-- [í•µì‹¬] ê²Œì„ ì‹œì‘ í”„ë¡œì„¸ìŠ¤ (ë¡œë”© í¬í•¨)
function SceneManager.StartGameProcess()
	print("ğŸš€ ê²Œì„ ì‹œì‘ í”„ë¡œì„¸ìŠ¤ ì§„ì…")

	-- 1. í íŒì—… & ë©”ì¸ í™”ë©´ ë„ê¸°
	queuePopup.Enabled = false
	mainScene.Enabled = false
	
	-- 2. ë¡œë”© í™”ë©´ ì¼œê¸°
	loadingScene.Enabled = true
	
	-- ë¡œë”© ë°”ë‚˜ í…ìŠ¤íŠ¸ê°€ ìˆë‹¤ë©´ ì´ˆê¸°í™”
	local loadingLabel = loadingScene:FindFirstChild("LoadingScene_ProgressLabel", true) 
	if loadingLabel then loadingLabel.Text = "ì—ì…‹ ë¡œë”© ì¤‘..." end

	--------------------------------------------------------
	-- 3. ì‹¤ì§ˆì  ì—ì…‹ ë¡œë”© (ContentProvider)
	--------------------------------------------------------
	-- ì—¬ê¸°ì„œ ê²Œì„ì— í•„ìš”í•œ ì—ì…‹(ì´ë¯¸ì§€, ì†Œë¦¬, ë©”ì‰¬ ë“±)ì„ ë¯¸ë¦¬ ì½ì–´ì˜µë‹ˆë‹¤.
	-- ì˜ˆì‹œ: IngameScene ì•ˆì— ìˆëŠ” ëª¨ë“  ì´ë¯¸ì§€ ë¡œë“œ
	
	local assetsToLoad = { ingameScene } -- ë¡œë”©í•  ëŒ€ìƒ ëª©ë¡
	
	local startTime = tick()
	
	-- PreloadAsyncëŠ” ì—ì…‹ì„ ë‹¤ ì½ì„ ë•Œê¹Œì§€ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë©ˆì¶¥ë‹ˆë‹¤(Yield).
	-- ì½œë°± í•¨ìˆ˜ë¥¼ í†µí•´ ì§„í–‰ë¥ ì„ í‘œì‹œí•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
	ContentProvider:PreloadAsync(assetsToLoad, function(contentId, status)
		-- (ì„ íƒì‚¬í•­) ì—¬ê¸°ì„œ ë¡œë”© ë°” ê²Œì´ì§€ë¥¼ ì±„ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
		-- print("ë¡œë”© ì¤‘:", contentId)
	end)
	
	-- ë¡œë”©ì´ ë„ˆë¬´ ë¹¨ë¦¬ ëë‚˜ë©´ ì–´ìƒ‰í•˜ë‹ˆê¹Œ ìµœì†Œ 2ì´ˆëŠ” ë³´ì—¬ì£¼ê¸° (ì„ íƒì‚¬í•­)
	local elapsedTime = tick() - startTime
	if elapsedTime < 2 then
		task.wait(2 - elapsedTime)
	end
	
	--------------------------------------------------------
	-- 4. ë¡œë”© ì™„ë£Œ -> ì¸ê²Œì„ ì§„ì…
	--------------------------------------------------------
	print("âœ… ë¡œë”© ì™„ë£Œ! ì¸ê²Œì„ìœ¼ë¡œ ì§„ì…í•©ë‹ˆë‹¤.")
	if loadingLabel then loadingLabel.Text = "ê²Œì„ ì‹œì‘!" end
	task.wait(0.5) -- "ê²Œì„ ì‹œì‘!" ë¬¸êµ¬ ë³´ì—¬ì¤„ ì‹œê°„
	
	loadingScene.Enabled = false -- ë¡œë”© ë„ê¸°
	ingameScene.Enabled = true   -- ì¸ê²Œì„ ì¼œê¸°
end

return SceneManager